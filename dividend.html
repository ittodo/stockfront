<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>배당 정보 추출(정기보고서)</title>
  <link rel="icon" href="data:," />
  <link rel="stylesheet" href="./styles.css" />
  <style>
    .wrap{max-width:1100px;margin:24px auto;padding:16px;border:1px solid #e5e7eb;border-radius:8px;background:#fff}
    .row{display:flex;gap:8px;align-items:center;margin:8px 0;position:relative}
    .row label{min-width:120px;color:#6b7280}
    .row input,.row select{flex:1;padding:8px;border:1px solid #e5e7eb;border-radius:6px}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border:1px solid #e5e7eb;padding:6px 8px;text-align:left}
    th{background:#f3f4f6}
    .log{margin-top:12px;white-space:pre-wrap;background:#f9fafb;border:1px solid #e5e7eb;padding:12px;border-radius:6px;font-family:ui-monospace,monospace}
    .flex{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .pill{display:inline-block;padding:2px 6px;border:1px solid #e5e7eb;border-radius:999px;background:#fff;color:#6b7280;font-size:12px}
  </style>
  <script defer src="./company-search.js"></script>
  <script>
// Shared dividend parsing utilities (inlined to avoid 404 on external script)
(() => {
  const htmlToText = (input) => {
    const htmlLike = /<[^>]+>/.test(input || '')
    if (!htmlLike) return String(input || '')
    return String(input || '')
      .replace(/<script[\s\S]*?<\/script>/gi, ' ')
      .replace(/<style[\s\S]*?<\/style>/gi, ' ')
      .replace(/<br\s*\/?>(?!>)/gi, '\n')
      .replace(/<\/(p|div|tr|li)>/gi, '\n')
      .replace(/<[^>]+>/g, ' ')
      .replace(/&nbsp;/gi, ' ')
      .replace(/&amp;/gi, '&')
      .replace(/&lt;/gi, '<')
      .replace(/&gt;/gi, '>')
  }

  const cleanNum = (s) => {
    if (!s) return null
    const m = (s+'').match(/([\d,]+(?:\.\d+)?)/)
    if (!m) return null
    const raw = m[1]
    const num = parseFloat(raw.replace(/,/g,''))
    return isFinite(num) ? { raw, num } : null
  }

  const toDate = (s) => {
    if (!s) return null
    const t = String(s).trim()
    let y,m,d
    if (/^\d{8}$/.test(t)) { y=t.slice(0,4); m=t.slice(4,6); d=t.slice(6,8) }
    else if (/^\d{4}-\d{2}-\d{2}$/.test(t)) { const parts=t.split('-'); y=parts[0]; m=parts[1]; d=parts[2] }
    else return null
    const dt = new Date(Number(y), Number(m)-1, Number(d))
    return isNaN(dt.getTime()) ? null : dt
  }

  const parseDecision = (txt) => {
    const plain = htmlToText(txt)
    const grab = (labelRe, valRe) => {
      const src = plain
      const m = src.match(labelRe)
      if (!m) return null
      const block = src.slice(m.index, Math.min(src.length, m.index + 400))
      const v = block.match(valRe)
      return v ? (v[1]||'').trim() : null
    }
    const kind = grab(/배당구분\s*/i, /배당구분\s*([가-힣A-Za-z]+)/i) || grab(/배당구분\s*\n?/i, /\n?\s*([가-힣A-Za-z]+)/)
    const type = grab(/배당종류\s*/i, /배당종류\s*([가-힣A-Za-z]+)/i)
    const tryFindDps = () => {
      const candidates = []
      const push = (val) => { const v = cleanNum(val); if (v) candidates.push(v) }
      let m
      const re1 = /(1주당|주당)\s*배당금\s*\(\s*원\s*\)\s*(?:[:\-]?\s*)?(?:보통주식|보통)?\s*([0-9][\d,\.]*)/gi
      while ((m = re1.exec(plain))){ if (!/총액/.test(m[0])) push(m[2]) }
      const re2 = /보통주식[^\n]{0,40}(1주당|주당)[^\n]{0,10}배당금[^\n]{0,10}\(\s*원\s*\)[^\n]{0,15}([0-9][\d,\.]*)/gi
      while ((m = re2.exec(plain))){ if (!/총액/.test(m[0])) push(m[2]) }
      const re3 = /주당\s*배당금\s*\(\s*원\s*\)\s*([0-9][\d,\.]*)/gi
      while ((m = re3.exec(plain))){ if (!/총액/.test(m[0])) push(m[1]) }
      return candidates.length ? candidates[0] : null
    }
    const dpsCommon = tryFindDps()
    const ratio = cleanNum(grab(/시가배당율\s*\(%\)/i, /보통주식\s*([\d,\.]+)/i) || grab(/시가배당율\s*\(%\)/i, /\(%\)\s*([\d,\.]+)/i))
    const total = cleanNum(grab(/배당금\s*총액\s*\(원\)/i, /\(원\)\s*([\d,\.]+)/i) || grab(/배당금총액\s*\(원\)/i, /\(원\)\s*([\d,\.]+)/i))
    const findYmdFlexible = (s) => {
      if (!s) return null
      const m = s.match(/(19|20)\d{2}\D{0,3}(\d{1,2})\D{0,3}(\d{1,2})/)
      if (!m) return null
      const y = s.match(/(19|20)\d{2}/)?.[0]
      const mm = m[2].padStart(2,'0')
      const dd = m[3].padStart(2,'0')
      return y ? `${y}-${mm}-${dd}` : null
    }
    let recDate = grab(/(배당\s*기준일|기준일자|기준일)/i, /(((19|20)\d{2})[-\.\/_년\s]{0,3}\d{1,2}[-\.\/_월\s]{0,3}\d{1,2})/)
    if (!recDate) {
      const src = plain
      const m = src.match(/(배당\s*기준일|기준일자|기준일)/i)
      if (m){
        const block = src.slice(m.index, Math.min(src.length, m.index + 200))
        recDate = findYmdFlexible(block)
      }
    }
    if (recDate) recDate = recDate.replace(/[\.\/_]/g,'-').replace(/년|월/g,'-').replace(/일/g,'').replace(/\s+/g,'-').replace(/-+/g,'-').replace(/-$/,'')
    const payDateRaw = grab(/배당금\s*지급[\s\S]{0,10}일자/i, /(((19|20)\d{2})[-\.\/_년\s]{0,3}\d{1,2}[-\.\/_월\s]{0,3}\d{1,2})/)
    const payDate = findYmdFlexible(payDateRaw || '')
    const boardDateRaw = grab(/이사회\s*결의일|결정일/i, /(((19|20)\d{2})[-\.\/_년\s]{0,3}\d{1,2}[-\.\/_월\s]{0,3}\d{1,2})/)
    const boardDate = findYmdFlexible(boardDateRaw || '')
    let precedence = null
    const T = plain.replace(/\s+/g,'')
    if (/선배당/.test(T)) precedence = '선배당'
    else if (/후배당/.test(T)) precedence = '후배당'
    else if (kind){
      if (/결산/.test(kind)) precedence = '후배당'
      else if (/중간|분기/.test(kind)) precedence = '선배당'
    }
    return { kind, type, dps: dpsCommon?.num || null, dps_raw: dpsCommon?.raw || null, ratio: ratio?.num || null, total: total?.num || null, total_raw: total?.raw || null, record_date: recDate || null, pay_date: payDate || null, board_date: boardDate || null, precedence }
  }

  window.DividendUtils = { parseDecision, toDate }
})()
  </script>
  <script defer src="./dividend.js"></script>
  <script type="module" src="./shared-footer.js"></script>
</head>
<body>
  <main class="wrap">
    <h1 style="margin:0 0 8px 0">배당 정보(정기보고서) 추출</h1>
    <p style="margin:0 0 8px 0;color:#6b7280">사업/반기/분기 보고서의 ‘배당’ 관련 구절을 추출해 요약합니다.</p>

    <div class="row">
      <label>API Base</label>
      <input id="api-base" placeholder="http://localhost:5000" />
    </div>
    <div class="row">
      <label>회사</label>
      <input id="corp" placeholder="회사명 또는 corpCode(8자리)" autocomplete="off" />
    </div>
    <!-- 기간 입력 제거: 1년 스캔은 자동으로 계산합니다. -->
    

    <h2 style="margin:16px 0 6px 0">배당 결정(B유형) 스캔</h2>
    <div class="row">
      <button id="btn-scan-b" class="btn">1년 범위 스캔(배당 제목·전체 유형)</button>
      <button id="btn-scan-csv" class="btn">CSV 내보내기</button>
    </div>
    <div id="scan-meta" class="log">대기 중…</div>
    <div id="scan-tbl"></div>
    <h2 style="margin:16px 0 6px 0">원문 미리보기</h2>
    <div id="scan-info" class="log" style="display:none">원문을 클릭하면 공시일자/배당기준일을 표시합니다.</div>
    <div id="scan-doc" class="log" style="margin-top:8px;padding:0;border:1px solid #e5e7eb;border-radius:6px;overflow:hidden"></div>
    <pre id="scan-raw" class="log" style="max-height:280px;overflow:auto"></pre>
  </main>
  <footer></footer>
</body>
</html>
